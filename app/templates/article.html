{% extends "base_logged_in.html" %}

{% block script %}
    <script src="{{ url_for('static', filename='ckeditor/ckeditor.js') }}"></script>
{% endblock %}

{% block content %}

{% if blog['permission'] == 'public' %}
    <h1>{{ blog['title'] }}</h1>
    <h3>{{ blog['author'] }}<small>~{{ momentjs(blog['create_time']).format('YYYY-MM-DD HH:mm') }}</small></h3>
    <h3>权限 {{ blog['permission'] }}</h3>
    <hr />
    <div>
        {{ blog['article']|safe }}
    </div>
    <hr />
    {% if comment_list[0] %}
        <h2>Reviews</h2>
        {% for comment in comment_list %}
        <div>
            <p><a href="{{ url_for('profile.user',username=comment['author']) }}" target="_blank">{{ comment['author'] }}</a></p>
            <p>{{ momentjs(comment['create_time']).format('YYYY-MM-DD HH:mm') }}</p>
            <p>{{ comment['content']|safe }}</p>
            {% if current_user.is_authenticated and current_user.username == blog['author'] %}
            <a href="{{ url_for('blog.blog_del_comment',blog_id=blog['_id'],comment_id=comment['_id']) }}" class="btn btn-danger">Delete</a>
            {% elif current_user.is_authenticated and current_user.username == comment['author'] %}
            <a href="{{ url_for('blog.blog_del_comment',blog_id=blog['_id'],comment_id=comment['_id']) }}" class="btn btn-danger">Delete</a>
            {% endif %}
        </div>
        {% endfor %}
    {% endif %}

    {% if current_user.is_authenticated %}
    <h3>添加评论</h3>
    <form action="{{ url_for('blog.blog_add_comment',blog_id=blog['_id']) }}" method="post">
        <textarea name="content" id="editor" class="ckeditor" rows="100" cols="80">
        </textarea>
        <button type="submit" class="btn btn-default">提交</button>
    </form>
    {% else %}
    <p>想添加评论？<a href="{{ url_for('auth.login') }}">登录</a></p>
    {% endif %}


    {% if current_user.is_authenticated and current_user.username == blog['author'] %}
        <p class="text-right"><a href="{{ url_for('blog.article_modify',blog_id=blog['_id']) }}">编辑文章</a> </p>
    {% endif %}

{% elif blog['author'] == current_user.username %}
    <h1>{{ blog['title'] }}</h1>
    <h3>{{ blog['author'] }}<small>~{{ momentjs(blog['create_time']).format('YYYY-MM-DD HH:mm') }}</small></h3>
    <h3>权限 {{ blog['permission'] }}</h3>
    <hr />
    <div>
        {{ blog['article']|safe }}
    </div>
    <hr />
    {% if comment_list[0] %}
        <h2>Reviews</h2>
        {% for comment in comment_list %}
        <div>
            <p><a href="{{ url_for('profile.user',username=comment['author']) }}" target="_blank">{{ comment['author'] }}</a></p>
            <p>{{ momentjs(comment['create_time']).format('YYYY-MM-DD HH:mm') }}</p>
            <p>{{ comment['content']|safe }}</p>
            {% if current_user.is_authenticated and current_user.username == blog['author'] %}
            <a href="{{ url_for('blog.blog_del_comment',blog_id=blog['_id'],comment_id=comment['_id']) }}" class="btn btn-danger">Delete</a>
            {% elif current_user.is_authenticated and current_user.username == comment['author'] %}
            <a href="{{ url_for('blog.blog_del_comment',blog_id=blog['_id'],comment_id=comment['_id']) }}" class="btn btn-danger">Delete</a>
            {% endif %}
        </div>
        {% endfor %}
    {% endif %}

    {% if current_user.is_authenticated %}
    <h3>添加评论</h3>
    <form action="{{ url_for('blog.blog_add_comment',blog_id=blog['_id']) }}" method="post">
        <textarea name="content" id="editor" class="ckeditor" rows="100" cols="80">
        </textarea>
        <button type="submit" class="btn btn-default">提交</button>
    </form>
    {% else %}
    <p>想添加评论？<a href="{{ url_for('auth.login') }}">登录</a></p>
    {% endif %}


    {% if current_user.is_authenticated and current_user.username == blog['author'] %}
        <p class="text-right"><a href="{{ url_for('blog.article_modify',blog_id=blog['_id']) }}">编辑文章</a> </p>
    {% endif %}

{% else %}
    <h2>你无法查看这篇文章。</h2>
{% endif %}

{% endblock %}